# Data Model — People, Places, Topics

_Last updated: 2025-11-04 (draft v0.1)_

This document defines the canonical rules for the `keyPeople`, `keyPlaces`, and `keyTopics` artefacts produced by the pipeline. It replaces ad-hoc string tagging with deterministic entities so chips are consistent, historically accurate, and linkable.

The goals:
- Keep the episode UI historically precise while avoiding duplicate chips.
- Provide canonical landing pages that aggregate related episodes.
- Give the LLM clear guardrails (prompts + validation) and a curation path for new concepts.

## Terminology

- **Display label** — The term rendered on an episode chip. It should reflect the most appropriate historical phrasing for that specific episode.
- **Canonical entity** — The single record in our registry (`people`, `places`, or `topics`) that represents the concept. Every display label resolves to exactly one canonical entity.
- **Alias** — Alternate names stored on the canonical entity to support matching. The UI may use an alias as a display label, but the landing page always shows the canonical name.
- **Pending entity** — A suggested addition generated by the LLM that requires manual approval before it can appear in the canonical registry.

## Category Definitions

-### People

- **Definition:** Individual human beings—historical, legendary, mythological, or unidentified—who are significant subjects of an episode.
- **Inclusions:** Historical figures, guests, rulers, artists; legendary figures (`King Arthur`), mythological characters (`Hercules`), and unidentified/composite personas (`Jack the Ripper`).
- **Exclusions:** Collectives (bands, organizations), offices/titles (e.g., “The Papacy”), mythological archetypes, unnamed roles (“The Captain”).
- **Canonical naming:** Use the most widely recognised short form (e.g., `Jesus`, `Horatio Nelson`, `Winston Churchill`). Store diacritic and alternate spellings in `aliases`. Use `type` to capture nuance (e.g., `person:legendary`, `person:mythological`, `person:unidentified`).
- **Display:** Chips may show any alias that fits the episode context, but they link to `/people/{id}` which renders the canonical label and alias list.

### Places

- **Definition:** Geographic entities relevant to an episode. Supports multiple granularities (sovereign states, constituent countries, regions, cities, sites, venues).
- **Inclusions:** Nations (`United Kingdom`), kingdoms (`England`), regions (`The Midlands`), cities (`Paris`), sites (`Trafalgar Square`), venues (`The Louvre`), historically renamed places (canonical `Istanbul`, alias `Constantinople`), and extinct entities (`Wessex`, `Library of Alexandria`).
- **Exclusions:** Supranational alliances (“Allies”, “Axis”), conceptual spaces (“The West”), abstract locations (“The Internet”); those belong in topics.
- **Canonical naming:** Pick the term historians use for the period/context. `England` and `Scotland` remain distinct from `United Kingdom`. `Britain` resolves to `United Kingdom` as an alias. Renamed places use aliases so chips can display historical labels (e.g., “Constantinople”) while resolving to the canonical entity.
- **Formatting:** No comma-combined entries (`Paris, France`) unless disambiguation is required. Prompt + validator enforce single-entity tokens.
- **Display:** Chips show context-appropriate labels (e.g., “Britain” for WW2 episodes) while linking to `/places/united-kingdom`. Sites/venues use their own canonical IDs.
- **Fictional settings:** Treat purely fictional geographies (`Middle-earth`, `Narnia`, `Westeros`) as topics, not places.

### Topics

- **Definition:** Themes, events, movements, organizations, concepts, or collectives that are central to the episode.
- **Examples:** `World War II`, `French Revolution`, `Napoleonic Wars`, `Nazis`, `Theme Parks`, `The Rolling Stones`, `British Empire`, `Atlases`, broader eras such as `The Middle Ages`, `The Renaissance`, `The Cold War`.
- **Rules:**
  - **Atomicity:** One concept per topic. Avoid fused labels like “Theme Parks & Disney”.
  - **Overlap allowed:** People and places may have parallel topics (e.g., `Walt Disney` vs topic `Disney`).
  - **Registry-driven:** Maintain a curated list for high-frequency topics with aliases (`WWII`, `Second World War` → `World War II`).
  - **Pending:** LLM may propose new topics with `isPending: true`, but they require review before being promoted to canonical.
- **Prompt tuning:** Ensure prompts differentiate between granular events (`Battle of Hastings`) and broader eras (`The Middle Ages`) so both are captured appropriately without conflation.

## Registry Schemas (Proposed)

All registries live under `data/rules/`.

```ts
type CanonicalEntity = {
  id: string;                // stable slug, e.g. "jesus", "united-kingdom"
  preferredName: string;     // canonical display name
  aliases?: string[];        // optional alternate labels (case-sensitive as needed)
  type?: string;             // optional subtype ("person", "nation", "city", "topic:movement", etc.)
  description?: string;      // optional summary for landing pages
  notes?: string;            // optional curation notes (e.g., naming style guidance)
  sources?: string[];        // optional reference links (Wikipedia, Britannica)
};
```

- `people.json` — array of `CanonicalEntity` with `type` defaulting to `"person"`.
- `places.json` — array with `type` pulled from a controlled list (`nation`, `kingdom`, `constituent-country`, `region`, `city`, `site`, `venue`, `extinct-polity`, `extinct-site`). Parent/lineage fields are **not** included in v0.1; historical name changes rely on aliases.
- `topics.json` — expands the existing file to include `preferredName`, `aliases`, optional `type` (e.g., `movement`, `organization`, `conflict`, `era`).

Pending proposals should be captured in `data/pending/{people|places|topics}.jsonl` with metadata (`proposedBy`, `episodeId`, `when`). The pipeline never surfaces pending entries publicly. The pending workflow is essential for Phase 1 QA, but the system must be designed so that, once accuracy thresholds are reached, we can graduate to fully automated entity creation.

## Display vs Canonical Resolution

1. Pipeline emits `displayName` (what the LLM selected) and `entityId` (resolved canonical ID).  
2. Composer writes both to `public/episodes.json` so the UI can render chips with the display label while linking to `/people/{entityId}`, `/places/{entityId}`, `/topics/{entityId}`.
3. Landing pages show the canonical name, alias list, type, and episode links.

If the LLM provides a string that does not match any registry alias:
- Validator rejects the record and logs a pending proposal for review.
- The publish workflow surfaces the error and skips adding the chip until the entity is curated.

## Prompt & Validation Guardrails (High-Level)

- Supply the canonical registries (or top-N slices) in the prompt context.
- Explicit instructions:
  - People: “Return only individuals from the registry. Do not emit collectives or titles. Use the canonical name when provided.”
  - Places: “Choose the historically correct entity for the time period. Do not combine city + country unless disambiguation is required. Prefer registry entries; propose a new place only if none matches.”
  - Topics: “Select up to N registry topics that best match the episode. Ensure each topic is a single concept. Only propose a new topic when nothing fits.”
- Validator responsibilities:
  - Ensure every emitted entity ID maps to the registry.
  - Reject mixed-category duplicates (e.g., a place label reused as a topic label unless explicitly allowed).
  - Flag missing chips (e.g., no people and no places) for curator review.
  - Enforce `isPending` semantics (pending entries never published).

## Future Considerations

- **Place lineage:** Defer parent/lineage metadata for v1; type tags plus aliases are sufficient for launch.
- **Descriptions & sources:** Treat as progressive enhancement. Landing pages may ship without them initially and gain curated copy later.
- **LLM proposal automation:**  
  - *Phase 1 — Human-in-the-loop:* Maintain the pending workflow during the initial rollout/backfill so curators validate every new entity and refine prompts.  
  - *Phase 2 — Automation goal:* Build toward trusting a well-instructed LLM to add entities directly once Phase 1 accuracy metrics are achieved, removing the permanent manual bottleneck.
- **Negative/absence tags:** Out of scope for v1; keep on the long-term ideas list.

---

**Next steps:**  
1. Populate initial registries with high-frequency entities (top 100 people, top 100 places, expanded topics).  
2. Update prompts to reference the registries.  
3. Extend validators + composer to store `entityId` alongside display labels.  
4. Re-run enrichment on a representative batch and review chip output against these rules.  
